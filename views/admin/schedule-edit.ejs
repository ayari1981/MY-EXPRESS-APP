<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> - المدرسة الإعدادية أبو القاسم الشابي</title>
  <link href="/css/output.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <%- include('../partials/navbar') %>
  
  <section class="min-h-screen bg-gray-100 py-8">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <!-- العودة -->
        <div class="mb-6">
          <a href="/admin/schedules" class="text-primary-600 hover:text-primary-800">
            <i class="fas fa-arrow-right ml-1"></i>
            العودة لقائمة الجداول
          </a>
        </div>

        <!-- نموذج التعديل -->
        <div class="bg-white rounded-lg shadow-md p-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">
            <i class="fas fa-edit ml-2 text-primary-600"></i>
            تعديل جدول
          </h2>
          <p class="text-gray-600 mb-8">
            تعديل معلومات الجدول أو استبدال الملف
          </p>

          <%- include('../partials/messages') %>

          <form action="/admin/schedules/edit/<%= schedule.id %>" method="POST" enctype="multipart/form-data">
            <!-- العنوان -->
            <div class="mb-6">
              <label class="block text-gray-700 font-semibold mb-2" for="title">
                <i class="fas fa-heading ml-2"></i>
                عنوان الجدول *
              </label>
              <input 
                type="text" 
                id="title" 
                name="title" 
                class="input-field"
                required
                value="<%= schedule.title %>"
              >
            </div>

            <!-- الوصف -->
            <div class="mb-6">
              <label class="block text-gray-700 font-semibold mb-2" for="description">
                <i class="fas fa-align-right ml-2"></i>
                الوصف (اختياري)
              </label>
              <textarea 
                id="description" 
                name="description" 
                class="input-field"
                rows="3"
              ><%= schedule.description || '' %></textarea>
            </div>

            <!-- نوع الجدول والقسم -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-gray-700 font-semibold mb-2" for="scheduleType">
                  <i class="fas fa-users ml-2"></i>
                  نوع الجدول *
                </label>
                <select id="scheduleType" name="scheduleType" class="input-field" required>
                  <option value="تلاميذ" <%= schedule.scheduleType === 'تلاميذ' ? 'selected' : '' %>>جدول التلاميذ</option>
                  <option value="أساتذة" <%= schedule.scheduleType === 'أساتذة' ? 'selected' : '' %>>جدول الأساتذة</option>
                </select>
              </div>

              <div>
                <label class="block text-gray-700 font-semibold mb-2" for="classLevel">
                  <i class="fas fa-graduation-cap ml-2"></i>
                  القسم المستهدف *
                </label>
                <select id="classLevel" name="classLevel" class="input-field" required>
                  <option value="السابعة أساسي" <%= schedule.classLevel === 'السابعة أساسي' ? 'selected' : '' %>>السابعة أساسي</option>
                  <option value="الثامنة أساسي" <%= schedule.classLevel === 'الثامنة أساسي' ? 'selected' : '' %>>الثامنة أساسي</option>
                  <option value="التاسعة أساسي" <%= schedule.classLevel === 'التاسعة أساسي' ? 'selected' : '' %>>التاسعة أساسي</option>
                  <option value="جميع الأقسام" <%= schedule.classLevel === 'جميع الأقسام' ? 'selected' : '' %>>جميع الأقسام</option>
                </select>
              </div>
            </div>

            <!-- الحالة -->
            <div class="mb-6">
              <label class="block text-gray-700 font-semibold mb-2" for="isActive">
                <i class="fas fa-toggle-on ml-2"></i>
                حالة الجدول
              </label>
              <select id="isActive" name="isActive" class="input-field">
                <option value="true" <%= schedule.isActive ? 'selected' : '' %>>نشط (مرئي للجميع)</option>
                <option value="false" <%= !schedule.isActive ? 'selected' : '' %>>غير نشط (مخفي)</option>
              </select>
            </div>

            <!-- الملف الحالي -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
              <h4 class="font-semibold text-gray-800 mb-2">
                <i class="fas fa-file ml-1"></i>
                الملف الحالي
              </h4>
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center ml-3">
                    <% if (schedule.fileType === 'pdf') { %>
                      <i class="fas fa-file-pdf text-red-600"></i>
                    <% } else if (schedule.fileType === 'xlsx' || schedule.fileType === 'xls') { %>
                      <i class="fas fa-file-excel text-green-600"></i>
                    <% } else if (schedule.fileType === 'jpg' || schedule.fileType === 'png') { %>
                      <i class="fas fa-file-image text-blue-600"></i>
                    <% } else { %>
                      <i class="fas fa-file-alt text-gray-600"></i>
                    <% } %>
                  </div>
                  <div>
                    <p class="font-semibold text-gray-800"><%= schedule.fileName %></p>
                    <p class="text-sm text-gray-500">
                      <%= (schedule.fileSize / 1024).toFixed(2) %> KB
                    </p>
                  </div>
                </div>
                <a href="/admin/schedules/download/<%= schedule.id %>" class="text-blue-600 hover:text-blue-800">
                  <i class="fas fa-download ml-1"></i>
                  تحميل
                </a>
              </div>
            </div>

            <!-- رفع ملف جديد -->
            <div class="mb-6">
              <label class="block text-gray-700 font-semibold mb-2" for="scheduleFile">
                <i class="fas fa-file-upload ml-2"></i>
                استبدال الملف (اختياري)
              </label>
              <input 
                type="file" 
                id="scheduleFile" 
                name="scheduleFile" 
                class="input-field"
                accept=".pdf,.docx,.doc,.xlsx,.xls,.jpg,.jpeg,.png"
              >
              <p class="text-sm text-gray-500 mt-1">
                اترك هذا الحقل فارغاً إذا كنت لا تريد تغيير الملف
              </p>
            </div>

            <!-- إحصائيات -->
            <div class="bg-blue-50 rounded-lg p-4 mb-6">
              <h4 class="font-semibold text-blue-800 mb-2">
                <i class="fas fa-chart-bar ml-1"></i>
                الإحصائيات
              </h4>
              <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                  <span class="text-gray-600">عدد التحميلات:</span>
                  <span class="font-semibold text-gray-800"><%= schedule.downloads %></span>
                </div>
                <div>
                  <span class="text-gray-600">تاريخ الرفع:</span>
                  <span class="font-semibold text-gray-800">
                    <%= new Date(schedule.created_at).toLocaleDateString('fr-FR') %>
                  </span>
                </div>
              </div>
            </div>

            <!-- أزرار الإجراء -->
            <div class="flex justify-end space-x-reverse space-x-4">
              <a href="/admin/schedules" class="btn-secondary">
                إلغاء
              </a>
              <button type="submit" class="btn-primary">
                <i class="fas fa-save ml-2"></i>
                حفظ التعديلات
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <%- include('../partials/footer') %>
</body>
</html>
