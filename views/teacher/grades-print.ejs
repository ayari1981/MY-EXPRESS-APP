<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - <%= filters.classLevel %></title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: white;
      color: #000;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 3px solid #000;
      padding-bottom: 20px;
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
      color: #000;
    }

    .header h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #333;
    }

    .teacher-info {
      text-align: center;
      font-size: 16px;
      color: #666;
      margin-bottom: 10px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
    }

    .info-item {
      display: flex;
      gap: 10px;
    }

    .info-label {
      font-weight: bold;
      color: #000;
    }

    .info-value {
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }

    thead {
      background: #333;
      color: white;
    }

    th {
      padding: 12px;
      text-align: right;
      font-weight: bold;
      border: 1px solid #000;
    }

    td {
      padding: 10px;
      text-align: right;
      border: 1px solid #666;
    }

    tbody tr:nth-child(even) {
      background: #f9f9f9;
    }

    tbody tr:hover {
      background: #e9e9e9;
    }

    .grade-value {
      font-weight: bold;
      font-size: 16px;
      color: #000;
    }

    .grade-excellent {
      color: #16a34a;
    }

    .grade-good {
      color: #2563eb;
    }

    .grade-average {
      color: #d97706;
    }

    .grade-poor {
      color: #dc2626;
    }

    .published-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    .published-yes {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #16a34a;
    }

    .published-no {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #dc2626;
    }

    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid #000;
      text-align: center;
      font-size: 12px;
      color: #666;
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .summary-card {
      background: #f0f0f0;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid #333;
    }

    .summary-value {
      font-size: 32px;
      font-weight: bold;
      color: #000;
      margin-bottom: 5px;
    }

    .summary-label {
      font-size: 14px;
      color: #666;
    }

    @media print {
      body {
        padding: 10px;
      }

      .no-print {
        display: none !important;
      }

      @page {
        margin: 1cm;
      }
    }
  </style>
</head>
<body>
  <!-- Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© -->
  <div class="header">
    <h1>Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø£Ø¨Ùˆ Ø§Ù„Ù‚Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø¨ÙŠ</h1>
    <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
    <div class="teacher-info">
      <strong>Ø§Ù„Ù…Ø¯Ø±Ø³: <%= teacher %></strong>
    </div>
  </div>

  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
  <div class="info-grid">
    <div class="info-item">
      <span class="info-label">Ø§Ù„Ù‚Ø³Ù…:</span>
      <span class="info-value"><%= filters.classLevel || 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…' %></span>
    </div>
    <div class="info-item">
      <span class="info-label">Ø±Ù‚Ù… Ø§Ù„ØµÙ:</span>
      <span class="info-value"><%= filters.classNumber || 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ' %></span>
    </div>
    <div class="info-item">
      <span class="info-label">Ø§Ù„Ù…Ø§Ø¯Ø©:</span>
      <span class="info-value"><%= filters.subject || 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯' %></span>
    </div>
    <div class="info-item">
      <span class="info-label">Ø§Ù„ÙØµÙ„:</span>
      <span class="info-value"><%= filters.semester || 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµÙˆÙ„' %></span>
    </div>
    <div class="info-item">
      <span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:</span>
      <span class="info-value"><%= printDate %></span>
    </div>
    <div class="info-item">
      <span class="info-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</span>
      <span class="info-value"><%= grades.length %> Ù†ØªÙŠØ¬Ø©</span>
    </div>
  </div>

  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <% 
    const totalGrades = grades.length;
    const publishedCount = grades.filter(g => g.isPublished).length;
    const averageGrade = grades.length > 0 ? 
      (grades.reduce((sum, g) => sum + parseFloat(g.gradeValue), 0) / grades.length).toFixed(2) : 0;
  %>
  
  <div class="summary">
    <div class="summary-card">
      <div class="summary-value"><%= totalGrades %></div>
      <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
    </div>
    <div class="summary-card">
      <div class="summary-value"><%= publishedCount %></div>
      <div class="summary-label">Ù†ØªØ§Ø¦Ø¬ Ù…Ù†Ø´ÙˆØ±Ø©</div>
    </div>
    <div class="summary-card">
      <div class="summary-value"><%= averageGrade %></div>
      <div class="summary-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…</div>
    </div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
  <% if (grades.length === 0) { %>
    <div style="text-align: center; padding: 40px; color: #666;">
      <p style="font-size: 18px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
    </div>
  <% } else { %>
    <table>
      <thead>
        <tr>
          <th style="width: 5%;">#</th>
          <th style="width: 20%;">Ø§Ø³Ù… Ø§Ù„ØªÙ„Ù…ÙŠØ°</th>
          <th style="width: 12%;">Ø§Ù„Ù‚Ø³Ù…</th>
          <th style="width: 15%;">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
          <th style="width: 12%;">Ù†ÙˆØ¹ Ø§Ù„ÙØ±Ø¶</th>
          <th style="width: 8%;">Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</th>
          <th style="width: 10%;">Ø§Ù„ÙØµÙ„</th>
          <th style="width: 10%;">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th style="width: 18%;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
        <% grades.forEach((grade, index) => { 
          const gradeValue = parseFloat(grade.gradeValue);
          let gradeClass = '';
          if (gradeValue >= 16) gradeClass = 'grade-excellent';
          else if (gradeValue >= 14) gradeClass = 'grade-good';
          else if (gradeValue >= 10) gradeClass = 'grade-average';
          else gradeClass = 'grade-poor';
        %>
          <tr>
            <td><%= index + 1 %></td>
            <td><strong><%= grade.studentFirstName %> <%= grade.studentLastName %></strong></td>
            <td><%= grade.studentClass %></td>
            <td><%= grade.subject %></td>
            <td><%= grade.gradeType %></td>
            <td class="grade-value <%= gradeClass %>"><%= grade.gradeValue %></td>
            <td><%= grade.semester %></td>
            <td>
              <% if (grade.isPublished) { %>
                <span class="published-badge published-yes">Ù…Ù†Ø´ÙˆØ±</span>
              <% } else { %>
                <span class="published-badge published-no">ØºÙŠØ± Ù…Ù†Ø´ÙˆØ±</span>
              <% } %>
            </td>
            <td><%= grade.remarks || '-' %></td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>

  <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
  <div class="footer">
    <p>Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø£Ø¨Ùˆ Ø§Ù„Ù‚Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø¨ÙŠ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>
    <p>Ø§Ù„Ù…Ø¯Ø±Ø³: <%= teacher %> | ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ØªØ§Ø±ÙŠØ®: <%= printDate %></p>
  </div>

  <!-- Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (ÙŠØ®ØªÙÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
  <div class="no-print" style="text-align: center; margin-top: 30px;">
    <button onclick="window.print()" 
            style="background: #16a34a; color: white; padding: 15px 40px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
      ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
    </button>
    <button onclick="window.close()" 
            style="background: #6b7280; color: white; padding: 15px 40px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-right: 10px;">
      âœ–ï¸ Ø¥ØºÙ„Ø§Ù‚
    </button>
  </div>

  <script>
    // Ø·Ø¨Ø§Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    // window.onload = function() { window.print(); };
  </script>
</body>
</html>