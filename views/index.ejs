<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="/css/output.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <%- include('partials/navbar') %>
  
  <!-- قسم البانر الرئيسي -->
  <section class="bg-gradient-to-l from-primary-600 to-primary-800 text-white py-20">
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-5xl font-bold mb-6 fade-in">
        المدرسة الإعدادية أبو القاسم الشابي
      </h1>
      <p class="text-2xl mb-8 slide-in">
        ننشئ جيل الغد بالعلم والمعرفة
      </p>
      <div class="flex justify-center space-x-reverse space-x-4 fade-in">
        <% if (!user) { %>
          <a href="/auth/register" class="bg-white text-primary-600 hover:bg-gray-100 font-bold py-3 px-8 rounded-lg transition-all shadow-lg">
            ابدأ الآن
          </a>
          <a href="/auth/login" class="border-2 border-white text-white hover:bg-white hover:text-primary-600 font-bold py-3 px-8 rounded-lg transition-all">
            تسجيل الدخول
          </a>
        <% } else { %>
          <a href="/dashboard" class="bg-white text-primary-600 hover:bg-gray-100 font-bold py-3 px-8 rounded-lg transition-all shadow-lg">
            لوحة التحكم
          </a>
        <% } %>
      </div>
    </div>
  </section>

  <!-- فضاءات المدرسة -->
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <h2 class="text-4xl font-bold text-center mb-12 text-gray-800">فضاءات المدرسة</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- فضاء التلميذ -->
        <div class="card hover:scale-105 transition-transform cursor-pointer">
          <div class="p-8 text-center">
            <div class="text-6xl text-blue-500 mb-4">
              <i class="fas fa-user-graduate"></i>
            </div>
            <h3 class="text-2xl font-bold mb-4 text-gray-800">فضاء التلميذ</h3>
            <p class="text-gray-600 mb-6">
              تحميل الدروس، جدول الحصص، والتفاعل مع المحتوى التعليمي
            </p>
            <a href="/auth/login" class="btn-primary inline-block">
              الدخول
            </a>
          </div>
        </div>

        <!-- فضاء المدرس -->
        <div class="card hover:scale-105 transition-transform cursor-pointer">
          <div class="p-8 text-center">
            <div class="text-6xl text-green-500 mb-4">
              <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <h3 class="text-2xl font-bold mb-4 text-gray-800">فضاء المدرس</h3>
            <p class="text-gray-600 mb-6">
              رفع الدروس، إدارة المحتوى، ومتابعة أداء التلاميذ
            </p>
            <a href="/auth/login" class="btn-primary inline-block">
              الدخول
            </a>
          </div>
        </div>

        <!-- فضاء الولي -->
        <div class="card hover:scale-105 transition-transform cursor-pointer">
          <div class="p-8 text-center">
            <div class="text-6xl text-purple-500 mb-4">
              <i class="fas fa-users"></i>
            </div>
            <h3 class="text-2xl font-bold mb-4 text-gray-800">فضاء الولي</h3>
            <p class="text-gray-600 mb-6">
              متابعة الأبناء، تقديم الملاحظات، والتواصل مع الإدارة
            </p>
            <a href="/auth/login" class="btn-primary inline-block">
              الدخول
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- لوحة الشرف - الطلاب المتميزون -->
  <% if (topStudents && Object.keys(topStudents).length > 0) { %>
  <section class="honor-board-section">
    <div class="honor-background-pattern"></div>
    <div class="container mx-auto px-4">
      <!-- العنوان الرئيسي -->
      <div class="honor-title-wrapper">
        <div class="trophy-icon-animated">
          <i class="fas fa-trophy"></i>
        </div>
        <h2 class="honor-main-title">
          <span class="title-top">لوحــة الشــرف</span>
          <span class="title-bottom">نجوم التميز والإبداع</span>
        </h2>
        <div class="title-decoration">
          <span class="star-dec">⭐</span>
          <span class="line-dec"></span>
          <span class="star-dec">⭐</span>
        </div>
      </div>

      <!-- عرض المواد في تصميم متقدم -->
      <div class="subjects-showcase">
        <% Object.keys(topStudents).forEach((subject, subjectIndex) => { %>
          <div class="subject-container" data-subject="<%= subject %>">
            <!-- رأس المادة -->
            <div class="subject-header-modern">
              <div class="subject-icon-wrapper">
                <i class="fas fa-graduation-cap"></i>
              </div>
              <h3 class="subject-name"><%= subject %></h3>
              <div class="subject-line"></div>
            </div>
            
            <!-- منصة التتويج -->
            <div class="podium-container">
              <% 
                const students = topStudents[subject];
                const positions = [1, 0, 2]; // الترتيب: ثاني، أول، ثالث
              %>
              <% positions.forEach((idx) => { 
                if (students[idx]) {
                  const student = students[idx];
                  const rank = idx + 1;
                  const podiumHeight = idx === 0 ? '1st' : idx === 1 ? '2nd' : '3rd';
              %>
                <div class="podium-place place-<%= podiumHeight %>" data-rank="<%= rank %>">
                  <div class="student-avatar">
                    <div class="avatar-circle rank-<%= rank %>">
                      <span class="avatar-initial"><%= student.firstName.charAt(0) %><%= student.lastName.charAt(0) %></span>
                    </div>
                    <div class="rank-crown">
                      <% if (rank === 1) { %>
                        <i class="fas fa-crown"></i>
                      <% } else if (rank === 2) { %>
                        <i class="fas fa-medal"></i>
                      <% } else { %>
                        <i class="fas fa-award"></i>
                      <% } %>
                    </div>
                  </div>
                  
                  <div class="student-info-card">
                    <h4 class="student-full-name"><%= student.firstName %> <%= student.lastName %></h4>
                    <p class="student-parent-name">
                      <i class="fas fa-user-circle"></i>
                      <% const gender = student.firstName.endsWith('ة') ? 'ابنة' : 'ابن'; %>
                      <%= gender %> السيد(ة) <%= student.parentName %>
                    </p>
                    <div class="grade-showcase">
                      <div class="grade-circle">
                        <svg class="grade-progress" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                          <circle class="grade-bg" cx="50" cy="50" r="45"></circle>
                          <circle class="grade-fill" cx="50" cy="50" r="45" 
                                  style="stroke-dashoffset: <%= 283 - (283 * student.avgGrade / 20) %>"></circle>
                        </svg>
                        <div class="grade-text">
                          <span class="grade-num"><%= student.avgGrade %></span>
                          <span class="grade-max">/20</span>
                        </div>
                      </div>
                    </div>
                    
                    <div class="stars-rating">
                      <% for(let i = 0; i < 5; i++) { %>
                        <% if (i < Math.floor(student.avgGrade / 4)) { %>
                          <i class="fas fa-star star-filled"></i>
                        <% } else { %>
                          <i class="far fa-star star-empty"></i>
                        <% } %>
                      <% } %>
                    </div>
                  </div>
                  
                  <div class="podium-base podium-<%= podiumHeight %>">
                    <div class="podium-rank">#<%= rank %></div>
                  </div>
                </div>
              <% } %>
              <% }); %>
            </div>
          </div>
        <% }); %>
      </div>

      <!-- قاعة المشاهير - تصميم متطور -->
      <div class="hall-of-fame">
        <div class="hall-title">
          <i class="fas fa-crown crown-icon"></i>
          <h3>قاعة المشاهير</h3>
          <p>الطلاب الأكثر تميزاً عبر جميع المواد</p>
        </div>
        
        <div class="fame-grid">
          <% 
            const allTopStudents = [];
            Object.keys(topStudents).forEach(subject => {
              topStudents[subject].forEach(student => {
                allTopStudents.push({ ...student, subject });
              });
            });
            allTopStudents.sort((a, b) => b.avgGrade - a.avgGrade);
            const top6 = allTopStudents.slice(0, 6);
          %>
          <% top6.forEach((student, index) => { %>
            <div class="fame-card position-<%= index + 1 %>">
              <div class="fame-card-header">
                <div class="fame-rank-badge">#<%= index + 1 %></div>
                <div class="fame-icon">
                  <% if (index === 0) { %>
                    <i class="fas fa-trophy trophy-gold"></i>
                  <% } else if (index === 1) { %>
                    <i class="fas fa-trophy trophy-silver"></i>
                  <% } else if (index === 2) { %>
                    <i class="fas fa-trophy trophy-bronze"></i>
                  <% } else { %>
                    <i class="fas fa-star star-blue"></i>
                  <% } %>
                </div>
              </div>
              
              <div class="fame-avatar-large">
                <div class="avatar-ring position-<%= index + 1 %>">
                  <span class="avatar-text"><%= student.firstName.charAt(0) %><%= student.lastName.charAt(0) %></span>
                </div>
              </div>
              
              <div class="fame-info">
                <h4 class="fame-name"><%= student.firstName %> <%= student.lastName %></h4>
                <p class="fame-parent">
                  <% const gender = student.firstName.endsWith('ة') ? 'ابنة' : 'ابن'; %>
                  <%= gender %> السيد(ة) <%= student.parentName %>
                </p>
                <div class="fame-subject-badge"><%= student.subject %></div>
              </div>
              
              <div class="fame-grade">
                <span class="fame-score"><%= student.avgGrade %></span>
                <span class="fame-total">/20</span>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    </div>
  </section>
  <% } %>

  <!-- المميزات -->
  <section class="py-16">
    <div class="container mx-auto px-4">
      <h2 class="text-4xl font-bold text-center mb-12 text-gray-800">لماذا نحن؟</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <div class="text-center p-6">
          <div class="text-5xl text-primary-600 mb-4">
            <i class="fas fa-book-open"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">مكتبة رقمية شاملة</h3>
          <p class="text-gray-600">جميع الدروس والموارد التعليمية في مكان واحد</p>
        </div>
        
        <div class="text-center p-6">
          <div class="text-5xl text-primary-600 mb-4">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">جدول حصص تفاعلي</h3>
          <p class="text-gray-600">تنظيم أفضل للوقت والدراسة</p>
        </div>
        
        <div class="text-center p-6">
          <div class="text-5xl text-primary-600 mb-4">
            <i class="fas fa-comments"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">تواصل فعّال</h3>
          <p class="text-gray-600">تواصل مباشر بين الإدارة والأولياء والتلاميذ</p>
        </div>
        
        <div class="text-center p-6">
          <div class="text-5xl text-primary-600 mb-4">
            <i class="fas fa-shield-alt"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">أمان وخصوصية</h3>
          <p class="text-gray-600">حماية كاملة لبيانات المستخدمين</p>
        </div>
      </div>
    </div>
  </section>

  <%- include('partials/footer') %>
  
  <script src="/js/main.js"></script>
</body>
</html>
